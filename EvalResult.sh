#################################################################################################
########################### NetVLAD1024 (FC, cg, MOE, cg, 1e-6) #################################
######################################## p100-2 #################################################
#################################################################################################
number 115021 | Avg_Hit@1: 0.897 | Avg_PERR: 0.812 | MAP: 0.513 | GAP: 0.868 | Avg_Loss: 3.588730
number 145930 | Avg_Hit@1: 0.897 | Avg_PERR: 0.812 | MAP: 0.517 | GAP: 0.870 | Avg_Loss: 3.557790
number 156144 | Avg_Hit@1: 0.898 | Avg_PERR: 0.815 | MAP: 0.520 | GAP: 0.872 | Avg_Loss: 3.514028
number 173705 | Avg_Hit@1: 0.898 | Avg_PERR: 0.814 | MAP: 0.519 | GAP: 0.872 | Avg_Loss: 3.549561
number 184150 | Avg_Hit@1: 0.898 | Avg_PERR: 0.812 | MAP: 0.519 | GAP: 0.872 | Avg_Loss: 3.548343
number 199160 | Avg_Hit@1: 0.897 | Avg_PERR: 0.813 | MAP: 0.519 | GAP: 0.871 | Avg_Loss: 3.574056
#################################################################################################
####################### NetVLAD1024 (FC, cg, MOE, cg, 1e-4) #####################################
######################################## p100-2 #################################################
#################################################################################################
number 153490 | Avg_Hit@1: 0.893 | Avg_PERR: 0.802 | MAP: 0.493 | GAP: 0.864 | Avg_Loss: 3.681310
number 173840 | Avg_Hit@1: 0.894 | Avg_PERR: 0.807 | MAP: 0.499 | GAP: 0.865 | Avg_Loss: 3.658738
number 193840 | Avg_Hit@1: 0.895 | Avg_PERR: 0.805 | MAP: 0.499 | GAP: 0.865 | Avg_Loss: 3.654116
number 213984 | Avg_Hit@1: 0.896 | Avg_PERR: 0.809 | MAP: 0.504 | GAP: 0.868 | Avg_Loss: 3.603307
number 234395 | Avg_Hit@1: 0.896 | Avg_PERR: 0.809 | MAP: 0.505 | GAP: 0.868 | Avg_Loss: 3.609462
number 244700 | Avg_Hit@1: 0.895 | Avg_PERR: 0.808 | MAP: 0.506 | GAP: 0.868 | Avg_Loss: 3.604132
#################################################################################################
######################## NetVLAD512 (FC, cg, MOE, cg, 1e-6) #####################################
######################################## instance-3 #############################################
#################################################################################################
number 116430 | Avg_Hit@1: 0.893 | Avg_PERR: 0.805 | MAP: 0.498 | GAP: 0.864 | Avg_Loss: 3.649766
number 164010 | Avg_Hit@1: 0.895 | Avg_PERR: 0.809 | MAP: 0.507 | GAP: 0.867 | Avg_Loss: 3.601083
number 178836 | Avg_Hit@1: 0.896 | Avg_PERR: 0.810 | MAP: 0.507 | GAP: 0.869 | Avg_Loss: 3.579602
number 199584 | Avg_Hit@1: 0.895 | Avg_PERR: 0.810 | MAP: 0.509 | GAP: 0.868 | Avg_Loss: 3.593650
number 211457 | Avg_Hit@1: 0.894 | Avg_PERR: 0.810 | MAP: 0.508 | GAP: 0.869 | Avg_Loss: 3.577316
number 232191 | Avg_Hit@1: 0.896 | Avg_PERR: 0.810 | MAP: 0.507 | GAP: 0.869 | Avg_Loss: 3.592527
#################################################################################################
##################### NetVLAD (1024FC, cg, 1024FC, cg, MOE, cg, 1e-6) ###########################
######################################## instance-3 #############################################
#################################################################################################
number 125020 | Avg_Hit@1: 0.894 | Avg_PERR: 0.807 | MAP: 0.502 | GAP: 0.866 | Avg_Loss: 3.628164
number 145020 | Avg_Hit@1: 0.896 | Avg_PERR: 0.809 | MAP: 0.504 | GAP: 0.868 | Avg_Loss: 3.591654
number 155020 | Avg_Hit@1: 0.897 | Avg_PERR: 0.812 | MAP: 0.510 | GAP: 0.870 | Avg_Loss: 3.551548
number 165020 | Avg_Hit@1: 0.898 | Avg_PERR: 0.812 | MAP: 0.512 | GAP: 0.870 | Avg_Loss: 3.565501
number 176677 | Avg_Hit@1: 0.895 | Avg_PERR: 0.810 | MAP: 0.510 | GAP: 0.869 | Avg_Loss: 3.598837
number 205440 | Avg_Hit@1: 0.897 | Avg_PERR: 0.811 | MAP: 0.514 | GAP: 0.870 | Avg_Loss: 3.596970
number 226173 | Avg_Hit@1: 0.898 | Avg_PERR: 0.811 | MAP: 0.512 | GAP: 0.869 | Avg_Loss: 3.643949
#################################################################################################
################# NetVLAD (1024FC, BN-RELU, 1024FC+FC, cg, MOE, cg, 1e-6) #######################
######################################## p100-2 #################################################
#################################################################################################
number 127590 | Avg_Hit@1: 0.893 | Avg_PERR: 0.805 | MAP: 0.502 | GAP: 0.864 | Avg_Loss: 3.679689
number 138151 | Avg_Hit@1: 0.893 | Avg_PERR: 0.807 | MAP: 0.506 | GAP: 0.866 | Avg_Loss: 3.653359
number 171335 | Avg_Hit@1: 0.894 | Avg_PERR: 0.809 | MAP: 0.510 | GAP: 0.868 | Avg_Loss: 3.623497
number 181553 | Avg_Hit@1: 0.896 | Avg_PERR: 0.809 | MAP: 0.511 | GAP: 0.868 | Avg_Loss: 3.618382
number 191703 | Avg_Hit@1: 0.896 | Avg_PERR: 0.811 | MAP: 0.512 | GAP: 0.868 | Avg_Loss: 3.608653
number 201757 | Avg_Hit@1: 0.896 | Avg_PERR: 0.811 | MAP: 0.514 | GAP: 0.870 | Avg_Loss: 3.595682
number 211845 | Avg_Hit@1: 0.895 | Avg_PERR: 0.810 | MAP: 0.513 | GAP: 0.868 | Avg_Loss: 3.650051
number 233160 | Avg_Hit@1: 0.893 | Avg_PERR: 0.809 | MAP: 0.513 | GAP: 0.867 | Avg_Loss: 3.683243
#################################################################################################
################# NetVLAD (512FC, BN-RELU, 512FC+FC, cg, MOE, cg, 1e-6) #########################
###################################### instance-3 ###############################################
#################################################################################################
number 167090 | Avg_Hit@1: 0.894 | Avg_PERR: 0.806 | MAP: 0.504 | GAP: 0.865 | Avg_Loss: 3.647042
number 177090 | Avg_Hit@1: 0.895 | Avg_PERR: 0.807 | MAP: 0.506 | GAP: 0.866 | Avg_Loss: 3.633603
number 187090 | Avg_Hit@1: 0.895 | Avg_PERR: 0.807 | MAP: 0.505 | GAP: 0.866 | Avg_Loss: 3.625103
number 197090 | Avg_Hit@1: 0.895 | Avg_PERR: 0.808 | MAP: 0.510 | GAP: 0.867 | Avg_Loss: 3.620851
number 217090 | Avg_Hit@1: 0.895 | Avg_PERR: 0.807 | MAP: 0.510 | GAP: 0.867 | Avg_Loss: 3.645604
number 237900 | Avg_Hit@1: 0.893 | Avg_PERR: 0.807 | MAP: 0.507 | GAP: 0.866 | Avg_Loss: 3.656178
#################################################################################################
############## NetVLAD [BN-RELU*(512FC,1024FC,2048FC), cg, MOE, cg, 1e-6] #######################
###################################### instance-3 ###############################################
#################################################################################################
number 113056 | Avg_Hit@1: 0.891 | Avg_PERR: 0.800 | MAP: 0.486 | GAP: 0.859 | Avg_Loss: 3.732474
number 155477 | Avg_Hit@1: 0.892 | Avg_PERR: 0.804 | MAP: 0.499 | GAP: 0.864 | Avg_Loss: 3.664339
number 169599 | Avg_Hit@1: 0.894 | Avg_PERR: 0.806 | MAP: 0.500 | GAP: 0.866 | Avg_Loss: 3.622756
number 175064 | Avg_Hit@1: 0.891 | Avg_PERR: 0.803 | MAP: 0.501 | GAP: 0.864 | Avg_Loss: 3.688801
number 186255 | Avg_Hit@1: 0.891 | Avg_PERR: 0.804 | MAP: 0.495 | GAP: 0.863 | Avg_Loss: 3.715373
number 197442 | Avg_Hit@1: 0.893 | Avg_PERR: 0.804 | MAP: 0.500 | GAP: 0.863 | Avg_Loss: 3.698611
number 209600 | Avg_Hit@1: 0.893 | Avg_PERR: 0.806 | MAP: 0.502 | GAP: 0.865 | Avg_Loss: 3.687454
number 215188 | Avg_Hit@1: 0.894 | Avg_PERR: 0.805 | MAP: 0.499 | GAP: 0.864 | Avg_Loss: 3.721508
#################################################################################################
############## NetVLAD [+1024 before vlad, 1024FC, cg, MOE, cg, 1e-6] ###########################
###################################### instance-3 ###############################################
#################################################################################################
number 190974 | Avg_Hit@1: 0.895 | Avg_PERR: 0.810 | MAP: 0.510 | GAP: 0.870 | Avg_Loss: 3.582142
number 205980 | Avg_Hit@1: 0.897 | Avg_PERR: 0.812 | MAP: 0.513 | GAP: 0.871 | Avg_Loss: 3.572899
number 213424 | Avg_Hit@1: 0.895 | Avg_PERR: 0.810 | MAP: 0.514 | GAP: 0.870 | Avg_Loss: 3.584459
number 218450 | Avg_Hit@1: 0.895 | Avg_PERR: 0.811 | MAP: 0.515 | GAP: 0.870 | Avg_Loss: 3.588556
number 228419 | Avg_Hit@1: 0.896 | Avg_PERR: 0.811 | MAP: 0.514 | GAP: 0.870 | Avg_Loss: 3.593260
number 233420 | Avg_Hit@1: 0.895 | Avg_PERR: 0.812 | MAP: 0.514 | GAP: 0.870 | Avg_Loss: 3.588823
#################################################################################################
############## NetVLAD [BN-RELU*(512FC,1024FC-concat), cg, MOE, cg, 1e-6] #######################
###################################### instance-3 ###############################################
#################################################################################################
python train.py --train_data_pattern="gs://youtube8m-ml-us-east1/2/frame/train/train*.tfrecord,gs://youtube8m-ml-us-east1/2/frame/validate/validate*.tfrecord" --model=NetVLADModelLF --train_dir ~/yt8m/v2/models/frame/NetVLAD512_1024 --frame_features --feature_names='rgb,audio' --feature_sizes='1024,128' --batch_size=80 --base_learning_rate=0.0002 --netvlad_cluster_size=256 --netvlad_hidden_size=512 --moe_l2=1e-6 --iterations=300 --learning_rate_decay=0.8 --netvlad_relu=False --gating=True --moe_prob_gating=True --max_steps=300000 --export_model_steps=5000
python eval.py --eval_data_pattern="gs://youtube8m-ml-us-east1/2/frame/validate/validate*.tfrecord" --train_dir ~/yt8m/v2/models/frame/NetVLAD512_1024 --frame_features --feature_names='rgb,audio' --feature_sizes='1024,128' --batch_size=128 --base_learning_rate=0.0002 --netvlad_cluster_size=256 --netvlad_hidden_size=512 --moe_l2=1e-6 --iterations=300 --learning_rate_decay=0.8 --netvlad_relu=False --gating=True --moe_prob_gating=True --run_once=True

